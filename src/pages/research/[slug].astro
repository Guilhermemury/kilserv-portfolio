---
import { getCollection } from 'astro:content';
import MainLayout from '../../layouts/MainLayout.astro';
import SectionHeader from '../../components/SectionHeader.astro'; // Import Added

export async function getStaticPaths() {
	const posts = await getCollection('research');
	return posts.map((entry) => ({
		params: { slug: entry.slug },
		props: { entry },
	}));
}

const { entry } = Astro.props;
const { Content } = await entry.render();
---

<MainLayout title={entry.data.title} description={entry.data.description}>
    <article>
        <SectionHeader command={`cat ${entry.slug}.md`} path="research" />

        <header class="article-meta">
            <h1>{entry.data.title}</h1>
            <div class="meta-row">
                <span class="date">> Date: {entry.data.pubDate.toISOString().split('T')[0]}</span>
                {entry.data.severity && <span class="sev">> Severity: {entry.data.severity}</span>}
            </div>
            <p class="abstract">{entry.data.description}</p>
        </header>

        <div class="markdown-content">
            <Content />
        </div>
        
        <div class="eof">
            [EOF] <a href="/research" class="back-link">cd ..</a>
        </div>
    </article>
</MainLayout>

<style>
    .article-meta { margin-bottom: 3rem; border-bottom: 1px solid var(--border); padding-bottom: 2rem; }
    .article-meta h1 { margin-bottom: 1rem; color: var(--fg); }
    .meta-row { display: flex; gap: 2rem; color: var(--fg-dim); font-size: 0.9rem; margin-bottom: 1.5rem; }
    .abstract { font-style: italic; color: var(--fg-dim); border-left: 2px solid var(--fg); padding-left: 1rem; }
    
    /* Markdown Styles */
    .markdown-content :global(h2) { margin-top: 2.5rem; border-bottom: 1px dashed var(--border); padding-bottom: 0.5rem; color: var(--fg); }
    .markdown-content :global(p) { margin-bottom: 1.5rem; line-height: 1.7; max-width: 70ch; }
    .markdown-content :global(code) { background: #111; padding: 0.2rem 0.4rem; font-size: 0.9em; border: 1px solid #333; color: #ddd; }
    .markdown-content :global(pre) { background: #0a0a0a; padding: 1.5rem; border: 1px solid #333; overflow-x: auto; margin: 2rem 0; }
    .markdown-content :global(ul) { list-style: square; margin-left: 1.5rem; margin-bottom: 1.5rem; }
    .markdown-content :global(li) { margin-bottom: 0.5rem; }
    
    .eof { text-align: center; margin-top: 4rem; color: var(--fg-dim); font-size: 0.9rem; }
    .back-link { margin-left: 1rem; color: var(--fg); font-weight: bold; }
</style>